<!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Iter8 makes it easy to maximize business value and guarantee SLOs during releases of your Kubernetes apps/ML models. Automate metrics-driven experiments and progressive delivery. Maximize release velocity while protecting end-user experience. Quick start in 5 mins."><meta name=author content="Srinivasan Parthasarathy"><link href=https://iter8.tools/0.4/reference/apispec/ rel=canonical><link rel=icon href=../../images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.1.3"><title>Iter8 API specification - Iter8</title><link rel=stylesheet href=../../assets/stylesheets/main.e35208c4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ef6f36e2.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-152813895-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:site_name content=Iter8><meta property=og:title content="The AI-driven Kubernetes experimentation platform"><meta property=og:description content="Iter8 makes it easy to maximize business value and guarantee SLOs during releases of your Kubernetes apps/ML models. Automate metrics-driven experiments and progressive delivery. Maximize release velocity while protecting end-user experience. Quick start in 5 mins."><meta property=og:url content=https://iter8.tools><meta property=og:image content=https://iter8.tools/0.4/images/illustration.png><!-- <meta property="og:image:type" content="image/png" /> --><!-- <meta property="og:image:width" content="1516" />
  <meta property="og:image:height" content="1410" /> --><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:url content=https://iter8.tools><meta name=twitter:creator content="Srinivasan Parthasarathy"><meta name=twitter:title content="The AI-driven Kubernetes experimentation platform"><meta name=twitter:description content="Iter8 makes it easy to maximize business value and guarantee SLOs during releases of your Kubernetes apps/ML models. Automate metrics-driven experiments and progressive delivery. Maximize release velocity while protecting end-user experience. Quick start in 5 mins."><meta name=twitter:image content=https://iter8.tools/0.4/images/illustration.png><meta name=twitter:label1 value=Experiments><meta name=twitter:data1 value="A/B, A/B/n, Canary, Conformance"><meta name=twitter:label2 value="K8s stacks"><meta name=twitter:data2 value="Knative, KFServing, Istio, ..."><!-- Extra stylesheets --><link rel=stylesheet href=../../stylesheets/main.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#iter8-api-specification class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-announce> <div class="md-announce__inner md-grid md-typeset"> <strong>Iter8</strong> at <a href=https://sched.co/iE2l>KubeCon + CloudNativeCon Europe 2021</a>. For updates and support, <a href=https://join.slack.com/t/iter8-tools/shared_invite/zt-awl2se8i-L0pZCpuHntpPejxzLicbmw> join <strong>Iter8</strong> workspace on <span class=twemoji> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </span> slack. </a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Iter8 class="md-header__button md-logo" aria-label=Iter8 data-md-component=logo> <img src=../../images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Iter8 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Iter8 API specification </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=pink data-md-color-accent=red type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/iter8-tools/iter8/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> iter8-tools/iter8 </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../concepts/whatisiter8/ class=md-tabs__link> Concepts </a> </li> <li class=md-tabs__item> <a href=../../getting-started/quick-start/with-knative/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../tutorials/knative/canary-progressive/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../metrics/using-metrics/ class=md-tabs__link> Metrics </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Reference </a> </li> <li class=md-tabs__item> <a href=../../contributing/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../../roadmap/ class=md-tabs__link> Roadmap </a> </li> <li class=md-tabs__item> <a href=https://blog.iter8.tools class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Iter8 class="md-nav__button md-logo" aria-label=Iter8 data-md-component=logo> <img src=../../images/logo.svg alt=logo> </a> Iter8 </label> <div class=md-nav__source> <a href=https://github.com/iter8-tools/iter8/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> iter8-tools/iter8 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/whatisiter8/ class=md-nav__link> What is Iter8? </a> </li> <li class=md-nav__item> <a href=../../concepts/features/ class=md-nav__link> Features </a> </li> <li class=md-nav__item> <a href=../../concepts/buildingblocks/ class=md-nav__link> Conceptual building blocks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1> Quick start <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Quick start" data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Quick start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/quick-start/with-knative/ class=md-nav__link> with Knative </a> </li> <li class=md-nav__item> <a href=../../getting-started/quick-start/with-kfserving/ class=md-nav__link> with KFServing </a> </li> <li class=md-nav__item> <a href=../../getting-started/quick-start/with-istio/ class=md-nav__link> with Istio </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../getting-started/install/ class=md-nav__link> Install </a> </li> <li class=md-nav__item> <a href=../../getting-started/changelog/ class=md-nav__link> Changelog </a> </li> <li class=md-nav__item> <a href=../../getting-started/help/ class=md-nav__link> Getting help </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tutorials data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1> Knative <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Knative data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Knative </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/knative/canary-progressive/ class=md-nav__link> Progressive canary release </a> </li> <li class=md-nav__item> <a href=../../tutorials/knative/canary-fixedsplit/ class=md-nav__link> Fixed split canary release </a> </li> <li class=md-nav__item> <a href=../../tutorials/knative/conformance/ class=md-nav__link> Conformance testing </a> </li> <li class=md-nav__item> <a href=../../tutorials/knative/mirroring/ class=md-nav__link> Conformance testing with traffic mirroring </a> </li> <li class=md-nav__item> <a href=../../tutorials/knative/traffic-segmentation/ class=md-nav__link> Progressive canary release with traffic segmentation </a> </li> <li class=md-nav__item> <a href=../../tutorials/knative/annotations/ class=md-nav__link> Useful Knative annotations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../tutorials/traffic/ class=md-nav__link> Generating requests externally </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Metrics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Metrics data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Metrics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../metrics/using-metrics/ class=md-nav__link> Using metrics in experiments </a> </li> <li class=md-nav__item> <a href=../../metrics/defining-iter8-metrics/ class=md-nav__link> Defining Iter8 metrics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reference data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Iter8 API specification <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Iter8 API specification </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> <nav class=md-nav aria-label=Resources> <ul class=md-nav__list> <li class=md-nav__item> <a href=#experiment class=md-nav__link> Experiment </a> <nav class=md-nav aria-label=Experiment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metadata class=md-nav__link> Metadata </a> </li> <li class=md-nav__item> <a href=#spec class=md-nav__link> Spec </a> </li> <li class=md-nav__item> <a href=#status class=md-nav__link> Status </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#metric class=md-nav__link> Metric </a> <nav class=md-nav aria-label=Metric> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metadata_1 class=md-nav__link> Metadata </a> </li> <li class=md-nav__item> <a href=#spec_1 class=md-nav__link> Spec </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experiment-field-types class=md-nav__link> Experiment field types </a> <nav class=md-nav aria-label="Experiment field types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strategy class=md-nav__link> Strategy </a> </li> <li class=md-nav__item> <a href=#taskspec class=md-nav__link> TaskSpec </a> </li> <li class=md-nav__item> <a href=#criteria class=md-nav__link> Criteria </a> </li> <li class=md-nav__item> <a href=#objective class=md-nav__link> Objective </a> </li> <li class=md-nav__item> <a href=#duration class=md-nav__link> Duration </a> </li> <li class=md-nav__item> <a href=#versioninfo class=md-nav__link> VersionInfo </a> </li> <li class=md-nav__item> <a href=#versiondetail class=md-nav__link> VersionDetail </a> </li> <li class=md-nav__item> <a href=#metricinfo class=md-nav__link> MetricInfo </a> </li> <li class=md-nav__item> <a href=#experimentcondition class=md-nav__link> ExperimentCondition </a> </li> <li class=md-nav__item> <a href=#analysis class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#versionassessmentanalysis class=md-nav__link> VersionAssessmentAnalysis </a> </li> <li class=md-nav__item> <a href=#aggregatedmetricsanalysis class=md-nav__link> AggregatedMetricsAnalysis </a> </li> <li class=md-nav__item> <a href=#aggregatedmetricsdata class=md-nav__link> AggregatedMetricsData </a> </li> <li class=md-nav__item> <a href=#aggregatedmetricsversiondata class=md-nav__link> AggregatedMetricsVersionData </a> </li> <li class=md-nav__item> <a href=#winnerassessmentanalysis class=md-nav__link> WinnerAssessmentAnalysis </a> </li> <li class=md-nav__item> <a href=#winnerassessmentdata class=md-nav__link> WinnerAssessmentData </a> </li> <li class=md-nav__item> <a href=#weightanalysis class=md-nav__link> WeightAnalysis </a> </li> <li class=md-nav__item> <a href=#weightdata class=md-nav__link> WeightData </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common-field-types class=md-nav__link> Common field types </a> <nav class=md-nav aria-label="Common field types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#namedvalue class=md-nav__link> NamedValue </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tasks class=md-nav__link> Tasks </a> <nav class=md-nav aria-label=Tasks> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task-implementations class=md-nav__link> Task implementations </a> <nav class=md-nav aria-label="Task implementations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#knativeinit-experiment class=md-nav__link> knative/init-experiment </a> </li> <li class=md-nav__item> <a href=#commonexec class=md-nav__link> common/exec </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#placeholder-substitution-in-task-inputs class=md-nav__link> Placeholder substitution in task inputs </a> </li> <li class=md-nav__item> <a href=#disable-interpolation-always-do-this-in-a-start-action class=md-nav__link> Disable Interpolation (always do this in a start action) </a> </li> <li class=md-nav__item> <a href=#error-handling-in-tasks class=md-nav__link> Error handling in tasks </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#target-naming-conventions class=md-nav__link> Target naming conventions </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../../roadmap/ class=md-nav__link> Roadmap </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Blog <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Blog data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://blog.iter8.tools class=md-nav__link> Blog link </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> <nav class=md-nav aria-label=Resources> <ul class=md-nav__list> <li class=md-nav__item> <a href=#experiment class=md-nav__link> Experiment </a> <nav class=md-nav aria-label=Experiment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metadata class=md-nav__link> Metadata </a> </li> <li class=md-nav__item> <a href=#spec class=md-nav__link> Spec </a> </li> <li class=md-nav__item> <a href=#status class=md-nav__link> Status </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#metric class=md-nav__link> Metric </a> <nav class=md-nav aria-label=Metric> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metadata_1 class=md-nav__link> Metadata </a> </li> <li class=md-nav__item> <a href=#spec_1 class=md-nav__link> Spec </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experiment-field-types class=md-nav__link> Experiment field types </a> <nav class=md-nav aria-label="Experiment field types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strategy class=md-nav__link> Strategy </a> </li> <li class=md-nav__item> <a href=#taskspec class=md-nav__link> TaskSpec </a> </li> <li class=md-nav__item> <a href=#criteria class=md-nav__link> Criteria </a> </li> <li class=md-nav__item> <a href=#objective class=md-nav__link> Objective </a> </li> <li class=md-nav__item> <a href=#duration class=md-nav__link> Duration </a> </li> <li class=md-nav__item> <a href=#versioninfo class=md-nav__link> VersionInfo </a> </li> <li class=md-nav__item> <a href=#versiondetail class=md-nav__link> VersionDetail </a> </li> <li class=md-nav__item> <a href=#metricinfo class=md-nav__link> MetricInfo </a> </li> <li class=md-nav__item> <a href=#experimentcondition class=md-nav__link> ExperimentCondition </a> </li> <li class=md-nav__item> <a href=#analysis class=md-nav__link> Analysis </a> </li> <li class=md-nav__item> <a href=#versionassessmentanalysis class=md-nav__link> VersionAssessmentAnalysis </a> </li> <li class=md-nav__item> <a href=#aggregatedmetricsanalysis class=md-nav__link> AggregatedMetricsAnalysis </a> </li> <li class=md-nav__item> <a href=#aggregatedmetricsdata class=md-nav__link> AggregatedMetricsData </a> </li> <li class=md-nav__item> <a href=#aggregatedmetricsversiondata class=md-nav__link> AggregatedMetricsVersionData </a> </li> <li class=md-nav__item> <a href=#winnerassessmentanalysis class=md-nav__link> WinnerAssessmentAnalysis </a> </li> <li class=md-nav__item> <a href=#winnerassessmentdata class=md-nav__link> WinnerAssessmentData </a> </li> <li class=md-nav__item> <a href=#weightanalysis class=md-nav__link> WeightAnalysis </a> </li> <li class=md-nav__item> <a href=#weightdata class=md-nav__link> WeightData </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common-field-types class=md-nav__link> Common field types </a> <nav class=md-nav aria-label="Common field types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#namedvalue class=md-nav__link> NamedValue </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tasks class=md-nav__link> Tasks </a> <nav class=md-nav aria-label=Tasks> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task-implementations class=md-nav__link> Task implementations </a> <nav class=md-nav aria-label="Task implementations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#knativeinit-experiment class=md-nav__link> knative/init-experiment </a> </li> <li class=md-nav__item> <a href=#commonexec class=md-nav__link> common/exec </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#placeholder-substitution-in-task-inputs class=md-nav__link> Placeholder substitution in task inputs </a> </li> <li class=md-nav__item> <a href=#disable-interpolation-always-do-this-in-a-start-action class=md-nav__link> Disable Interpolation (always do this in a start action) </a> </li> <li class=md-nav__item> <a href=#error-handling-in-tasks class=md-nav__link> Error handling in tasks </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#target-naming-conventions class=md-nav__link> Target naming conventions </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/iter8-tools/iter8/edit/master/mkdocs/docs/reference/apispec.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=iter8-api-specification>Iter8 API Specification<a class=headerlink href=#iter8-api-specification title="Permanent link">&para;</a></h1> <div class="admonition abstract"> <p class=admonition-title>Abstract</p> <p>The Iter8 API provides two <a href=https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/ >Kubernetes custom resources</a> to automate metrics and AI-driven experiments, progressive delivery, and rollout of Kubernetes and OpenShift apps.</p> <ol> <li>The <strong>Experiment</strong> resource provides expressive controls required by application developers and service operators who wish to automate new releases of their apps in a robust, principled and metrics-driven manner. These controls encompass <a href=../../../concepts/buildingblocks/ >testing, deployment, traffic shaping, and version promotion functions</a> and can be flexibly composed to automate <a href=../../../tutorials/knative/canary-progressive/ >diverse use-cases</a>.</li> <li>The <strong>Metric</strong> resource encapsulates the REST query that is used by Iter8 for retrieving a metric value from the metrics provider. Metrics are referenced in experiments.</li> </ol> </div> <div class="admonition note"> <p class=admonition-title>API Version</p> <p>This document describes version <strong>v2alpha2</strong> of the Iter8 API.</p> </div> <h2 id=resources>Resources<a class=headerlink href=#resources title="Permanent link">&para;</a></h2> <h3 id=experiment>Experiment<a class=headerlink href=#experiment title="Permanent link">&para;</a></h3> <details class=info><summary>Sample experiment</summary><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8.tools/v2alpha2</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Experiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">quickstart-exp</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=c1># target identifies the knative service under experimentation using its fully qualified name</span>
  <span class=nt>target</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default/sample-app</span>
  <span class=nt>strategy</span><span class=p>:</span>
    <span class=c1># this experiment will perform a canary test</span>
    <span class=nt>testingPattern</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Canary</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class=nt>start</span><span class=p>:</span> <span class=c1># run a sequence of tasks at the start of the experiment</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">knative/init-experiment</span>
      <span class=nt>finish</span><span class=p>:</span> <span class=c1># run the following sequence of tasks at the end of the experiment</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span> <span class=c1># promote the winning version</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">kubectl</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;apply&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;-f&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/{{</span><span class=nv> </span><span class=s>.promote</span><span class=nv> </span><span class=s>}}.yaml&quot;</span>
  <span class=nt>criteria</span><span class=p>:</span>
    <span class=c1># mean latency of version should be under 50 milliseconds</span>
    <span class=c1># 95th percentile latency should be under 100 milliseconds</span>
    <span class=c1># error rate should be under 1%</span>
    <span class=nt>objectives</span><span class=p>:</span> 
    <span class="p p-Indicator">-</span> <span class=nt>metric</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8-knative/mean-latency</span>
      <span class=nt>upperLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
    <span class="p p-Indicator">-</span> <span class=nt>metric</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8-knative/95th-percentile-tail-latency</span>
      <span class=nt>upperLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="p p-Indicator">-</span> <span class=nt>metric</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8-knative/error-rate</span>
      <span class=nt>upperLimit</span><span class=p>:</span> <span class=s>&quot;0.01&quot;</span>
  <span class=nt>duration</span><span class=p>:</span>
    <span class=nt>intervalSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
    <span class=nt>iterationsPerLoop</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class=nt>versionInfo</span><span class=p>:</span>
    <span class=c1># information about app versions used in this experiment</span>
  <span class=nt>baseline</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">current</span>
    <span class=nt>variables</span><span class=p>:</span>
    <span class=c1># variables are used when querying metrics and when interpolating task inputs</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v1</span> 
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">baseline</span>
  <span class=nt>candidates</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candidate</span>
    <span class=nt>variables</span><span class=p>:</span>
    <span class=c1># variables are used when querying metrics and when interpolating task inputs</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v2</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candidate</span> 
</code></pre></div> </td></tr></table> </details> <h4 id=metadata>Metadata<a class=headerlink href=#metadata title="Permanent link">&para;</a></h4> <p>Standard Kubernetes <a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#objectmeta-v1-meta>meta.v1/ObjectMeta</a> resource.</p> <h4 id=spec>Spec<a class=headerlink href=#spec title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>target</td> <td>string</td> <td>Identifies the app under experimentation and determines which experiments can run concurrently. Experiments that have the same target value will not be scheduled concurrently but will be run sequentially in the order of their creation timestamps. Experiments whose target values differ from each other can be scheduled by Iter8 concurrently. It is good practice to follow <a href=#target-naming-conventions>target naming conventions</a>.</td> <td>Yes</td> </tr> <tr> <td>strategy</td> <td><a href=#strategy>Strategy</a></td> <td>The experimentation strategy which specifies how app versions are tested, how traffic is shifted during experiment, and what tasks are executed at the start and end of the experiment.</td> <td>Yes</td> </tr> <tr> <td>criteria</td> <td><a href=#criteria>Criteria</a></td> <td>Criteria used for evaluating versions. This section includes service-level objectives (SLOs) and indicators (SLIs).</td> <td>No</td> </tr> <tr> <td>duration</td> <td><a href=#duration>Duration</a></td> <td>Duration of the experiment.</td> <td>No</td> </tr> <tr> <td>versionInfo</td> <td><a href=#versioninfo>VersionInfo</a></td> <td>Versions involved in the experiment. Every experiment involves a baseline version, and may involve zero or more candidates.</td> <td>No</td> </tr> </tbody> </table> <h4 id=status>Status<a class=headerlink href=#status title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>conditions</td> <td>[]<a href=#experimentcondition>ExperimentCondition</a></td> <td>A set of conditions that express progress of an experiment.</td> <td>No</td> </tr> <tr> <td>initTime</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The time the experiment is created.</td> <td>No</td> </tr> <tr> <td>startTime</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The time when the first iteration of experiment begins</td> <td>No</td> </tr> <tr> <td>lastUpdateTime</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The time when the status was most recently updated.</td> <td>No</td> </tr> <tr> <td>stage</td> <td>string</td> <td>Indicator of the progress of an experiment. The stage is <code>Waiting</code> before an experiment executes its start action, <code>Initializing</code> while running the start action, <code>Running</code> while the experiment has begun its first iteration and is progressing, <code>Finishing</code> while any finish action is running and <code>Completed</code> when the experiment terminates.</td> <td>No</td> </tr> <tr> <td>completedIterations</td> <td>int32</td> <td>Number of completed iterations of the experiment. This is undefined until the experiment reaches the <code>Running</code> stage.</td> <td>No</td> </tr> <tr> <td>currentWeightDistribution</td> <td>[]<a href=#weightdata>WeightData</a></td> <td>Currently observed split of traffic between versions. Expressed as percentage.</td> <td>No</td> </tr> <tr> <td>analysis</td> <td>Analysis</td> <td>Result of latest query to the Iter8 analytics service.</td> <td>No</td> </tr> <tr> <td>versionRecommendedForPromotion</td> <td>string</td> <td>The version recommended for promotion. This field is initially populated by Iter8 as the baseline version and continuously updated during the course of the experiment to match the winner. The value of this field is typically used by finish actions to promote a version at the end of an experiment.</td> <td>No</td> </tr> <tr> <td>metrics</td> <td>[]<a href=#metricinfo>MetricInfo</a></td> <td>A list of metrics referenced in the criteria section of this experiment.</td> <td>No</td> </tr> <tr> <td>message</td> <td>string</td> <td>Human readable message.</td> <td>No</td> </tr> </tbody> </table> <h3 id=metric>Metric<a class=headerlink href=#metric title="Permanent link">&para;</a></h3> <p>Metrics are referenced within the criteria field of the experiment spec. Metrics usage within experiments is described <a href=../../../metrics/using-metrics>here</a>.</p> <details class=example><summary>Sample metric</summary><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8.tools/v2alpha2</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Metric</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">request-count</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>params</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">query</span>
    <span class=nt>value</span><span class=p>:</span> <span class="p p-Indicator">|</span>
      <span class=no>sum(increase(revision_app_request_latencies_count{revision_name=&#39;$revision&#39;}[$elapsedTime])) or on() vector(0)</span>
  <span class=nt>description</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Number of requests</span>
  <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">counter</span>
  <span class=nt>provider</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class=nt>jqExpression</span><span class=p>:</span> <span class=s>&quot;.data.result[0].value[1]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>tonumber&quot;</span>
  <span class=nt>urlTemplate</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http://prometheus-operated.iter8-system:9090/api/v1/query</span>      
</code></pre></div> </td></tr></table> </details> <h4 id=metadata_1>Metadata<a class=headerlink href=#metadata_1 title="Permanent link">&para;</a></h4> <p>Standard Kubernetes <a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#objectmeta-v1-meta>meta.v1/ObjectMeta</a> resource.</p> <h4 id=spec_1>Spec<a class=headerlink href=#spec_1 title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>description</td> <td>string</td> <td>Human readable description. This field is meant for informational purposes.</td> <td>No</td> </tr> <tr> <td>units</td> <td>string</td> <td>Units of measurement. This field is meant for informational purposes.</td> <td>No</td> </tr> <tr> <td>provider</td> <td>string</td> <td>Type of the metrics provider. This field is meant for informational purposes.</td> <td>No</td> </tr> <tr> <td>params</td> <td>[]<a href=#namedvalue>NamedValue</a></td> <td>List of name/value pairs corresponding to the name and value of the HTTP query parameters used by Iter8 when querying the metrics provider. Each name represents a parameter name; the corresponding value is a string template with placeholders; the placeholders will be dynamically substituted by Iter8 with values at query time.</td> <td>No</td> </tr> <tr> <td>body</td> <td>string</td> <td>String used to construct the JSON body of the HTTP request. Body may be templated, in which Iter8 will attempt to substitute placeholders in the template at query time using version information.</td> <td>No</td> </tr> <tr> <td>type</td> <td>string</td> <td>Metric type. Valid values are <code>Counter</code> and <code>Gauge</code>. Default value = <code>Gauge</code>. A <code>Counter</code> metric is one whose value never decreases over time. A <code>Gauge</code> metric is one whose value may increase or decrease over time.</td> <td>No</td> </tr> <tr> <td>method</td> <td>string</td> <td>HTTP method (verb) used in the HTTP request. Valid values are <code>GET</code> and <code>POST</code>. Default value = <code>GET</code>.</td> <td>No</td> </tr> <tr> <td>authType</td> <td>string</td> <td>Identifies the type of authentication used in the HTTP request. Valid values are <code>Basic</code>, <code>Bearer</code> and <code>APIKey</code> which correspond to HTTP authentication with these respective methods.</td> <td>No</td> </tr> <tr> <td>sampleSize</td> <td>string</td> <td>Reference to a metric that represents the number of data points over which the value of this metric is computed. This field applies only to <code>Gauge</code> metrics. References can be expressed in the form 'name' or 'namespace/name'. If just <code>name</code> is used, the implied namespace is the namespace of the referring metric.</td> <td>No</td> </tr> <tr> <td>secret</td> <td>string</td> <td>Reference to a secret that contains information used for authenticating with the metrics provider. In particular, Iter8 uses data in this secret to substitute placeholders in the HTTP headers and URL while querying the provider. References can be expressed in the form 'name' or 'namespace/name'. If just <code>name</code> is used, the implied namespace is the namespace where Iter8 is installed (which is <code>iter8-system</code> by default).</td> <td>No</td> </tr> <tr> <td>headerTemplates</td> <td>[]<a href=#namedvalue>NamedValue</a></td> <td>List of name/value pairs corresponding to the name and value of the HTTP request headers used by Iter8 when querying the metrics provider. Each name represents a header field name; the corresponding value is a string template with placeholders; the placeholders will be dynamically substituted by Iter8 with values at query time. Placeholder substitution is attempted only if <code>authType</code> and <code>secret</code> fields are present.</td> <td>No</td> </tr> <tr> <td>jqExpression</td> <td>string</td> <td>The <a href=https://stedolan.github.io/jq/ >jq</a> expression used by Iter8 to extract the metric value from the JSON response returned by the provider.</td> <td>Yes</td> </tr> <tr> <td>urlTemplate</td> <td>string</td> <td>Template for the metric provider's URL. Typically, urlTemplate is expected to be the actual URL without any placeholders. However, urlTemplate may be templated, in which case, Iter8 will attempt to substitute placeholders in the urlTemplate at query time using the <code>secret</code> referenced in the metric. Placeholder substitution will not be attempted if <code>secret</code> is not specified.</td> <td>Yes</td> </tr> </tbody> </table> <h2 id=experiment-field-types>Experiment field types<a class=headerlink href=#experiment-field-types title="Permanent link">&para;</a></h2> <h3 id=strategy>Strategy<a class=headerlink href=#strategy title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>testingPattern</td> <td>string</td> <td>Determines the logic used to evaluate the app versions and determine the winner of the experiment. Iter8 supports two testing patterns, namely, <code>Canary</code> and <code>Conformance</code>.</td> <td>Yes</td> </tr> <tr> <td>deploymentPattern</td> <td>string</td> <td>Determines if and how traffic is shifted during an experiment. This field is relevant only for experiments using the <code>Canary</code> testing pattern. Iter8 supports two deployment patterns, namely, <code>Progressive</code> and <code>FixedSplit</code>.</td> <td>No</td> </tr> <tr> <td>actions</td> <td>map[string][]<a href=#taskspec>TaskSpec</a></td> <td>An action is a sequence of tasks that can be executed by Iter8. <code>spec.strategy.actions</code> can be used to specify start and finish actions that will be run at the start and end of an experiment respectively.</td> <td>No</td> </tr> </tbody> </table> <h3 id=taskspec>TaskSpec<a class=headerlink href=#taskspec title="Permanent link">&para;</a></h3> <div class="admonition abstract"> <p>Specification of a task that will be executed as part of experiment actions. Task implementations are organized into libraries as documented <a href=#task-implementations>here</a>.</p> </div> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>task</td> <td>string</td> <td>Name of the task. Task names express both the library and the task within the library in the format 'library/task' .</td> <td>Yes</td> </tr> <tr> <td>with</td> <td>map[string]<a href=https://pkg.go.dev/k8s.io/apiextensions-apiserver/pkg/apis/apiextensions/v1#JSON>apiextensionsv1.JSON</a></td> <td>Inputs to the task.</td> <td>No</td> </tr> </tbody> </table> <h3 id=criteria>Criteria<a class=headerlink href=#criteria title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>requestCount</td> <td>string</td> <td>Reference to the metric used to count the number of requests sent to app versions.</td> <td>No</td> </tr> <tr> <td>objectives</td> <td><a href=#objective>Objective</a>[]</td> <td>A list of metrics along with acceptable upper limits, lower limits, or both upper and lower limits for them. Iter8 will verify if app versions satisfy these objectives.</td> <td>No</td> </tr> <tr> <td>indicators</td> <td>string[]</td> <td>A list of metric references. Iter8 will collect and report the values of these metrics in addition to those referenced in the <code>objectives</code> section.</td> <td>No</td> </tr> </tbody> </table> <div class="admonition warning"> <p><strong>Note:</strong> References to metric resource objects within experiment criteria should be in the <code>namespace/name</code> format or in the <code>name</code> format. If the <code>name</code> format is used (i.e., if only the name of the metric is specified), then Iter8 searches for the metric in the namespace of the experiment resource. If Iter8 cannot find the metric, then the reference is considered invalid and the experiment will terminate in a failure.</p> </div> <h3 id=objective>Objective<a class=headerlink href=#objective title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>metric</td> <td>string</td> <td>Reference to a metric resource. Also see <a href=#criteria>note on metric references</a>.</td> <td>Yes</td> </tr> <tr> <td>upperLimit</td> <td><a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/ >Quantity</a></td> <td>Upper limit on the metric value. If specified, for a version to satisfy this objective, its metric value needs to be below the limit.</td> <td>No</td> </tr> <tr> <td>lowerLimit</td> <td><a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/ >Quantity</a></td> <td>Lower limit on the metric value. If specified, for a version to satisfy this objective, its metric value needs to be above the limit.</td> <td>No</td> </tr> </tbody> </table> <h3 id=duration>Duration<a class=headerlink href=#duration title="Permanent link">&para;</a></h3> <div class="admonition abstract"> <p>The duration of the experiment.</p> </div> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>intervalSeconds</td> <td>int32</td> <td>Duration of a single iteration of the experiment in seconds. Default value = 20 seconds.</td> <td>No</td> </tr> <tr> <td>maxIterations</td> <td>int32</td> <td>Maximum number of iterations in the experiment. In case of failure, the experiment may be terminated earlier. Default value = 15.</td> <td>No</td> </tr> </tbody> </table> <h3 id=versioninfo>VersionInfo<a class=headerlink href=#versioninfo title="Permanent link">&para;</a></h3> <div class="admonition abstract"> <p><code>spec.versionInfo</code> describes the app versions involved in the experiment. Every experiment involves a <code>baseline</code> version, and may involve zero or more <code>candidates</code>.</p> </div> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>baseline</td> <td><a href=#versiondetail>VersionDetail</a></td> <td>Details of the current or baseline version.</td> <td>Yes</td> </tr> <tr> <td>candidates</td> <td>[]<a href=#versiondetail>VersionDetail</a></td> <td>Details of the candidate version or versions, if any.</td> <td>No</td> </tr> </tbody> </table> <div class="admonition note"> <p class=admonition-title>Number of versions</p> <p><code>Conformance</code> experiments involve only a single version (baseline). Hence, in <code>Conformance</code> experiments, the <code>candidates</code> field of versionInfo must be omitted. A <code>Canary</code> experiment involves two versions, <code>baseline</code> and <code>candidate</code>. Hence, in <code>Canary</code> experiments, the <code>candidates</code> field must be a list of length one and must contain a single versionDetail object.<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup></p> </div> <div class="admonition note"> <p class=admonition-title>Auto-creation of VersionInfo</p> <p>Iter8 ships with helper tasks that can inspect an experiment resource with no or partially specified <code>spec.versionInfo</code>, automatically generate the remaining portion of <code>spec.versionInfo</code> and update the experiment with this information. See the <a href=#task-implementations><code>init-experiment</code> task in the <code>knative</code> task library</a> for an example.</p> </div> <h3 id=versiondetail>VersionDetail<a class=headerlink href=#versiondetail title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>name</td> <td>string</td> <td>Name of the version.</td> <td>Yes</td> </tr> <tr> <td>variables</td> <td>[]<a href=#namedvalue>NamedValue</a></td> <td>Variables are name-value pairs associated with a version. Metrics and tasks within experiment specs can contain strings with placeholders. Iter8 uses variables to substitute placeholders in these strings.</td> <td>No</td> </tr> <tr> <td>weightObjRef</td> <td><a href=https://pkg.go.dev/k8s.io/api@v0.20.0/core/v1#ObjectReference>corev1.ObjectReference</a></td> <td>Reference to a Kubernetes resource and a field-path within the resource. Iter8 uses <code>weightObjRef</code> to get or set weight (traffic percentage) for the version.</td> <td>No</td> </tr> </tbody> </table> <h3 id=metricinfo>MetricInfo<a class=headerlink href=#metricinfo title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>name</td> <td>string</td> <td>Identifies an Iter8 metric using the <a href=#criteria><code>namespace/name</code> or <code>name</code> format</a>.</td> <td>Yes</td> </tr> <tr> <td>metric</td> <td>[]<a href=#metric>Metric</a></td> <td>Iter8 metric object referenced by name.</td> <td>No</td> </tr> </tbody> </table> <h3 id=experimentcondition>ExperimentCondition<a class=headerlink href=#experimentcondition title="Permanent link">&para;</a></h3> <div class="admonition abstract"> <p>Conditions express aspects of the progress of an experiment. The <code>Completed</code> condition indicates whether or not an experiment has completed. The <code>Failed</code> condition indicates whether or not an experiment completed successfully or in failure. The <code>TargetAcquired</code> condition indicates that an experiment has acquired the target and is now scheduled to run. At any point in time, for any given target, Iter8 ensures that at most one experiment has the conditions <code>TargetAcquired</code> set to <code>True</code> and <code>Completed</code> set to <code>False</code>.</p> </div> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>type</td> <td>string</td> <td>Type of condition. Valid types are <code>TargetAcquired</code>, <code>Completed</code> and <code>Failed</code>.</td> <td>Yes</td> </tr> <tr> <td>status</td> <td><a href=https://pkg.go.dev/k8s.io/api@v0.20.0/core/v1#ConditionStatus>corev1.ConditionStatus</a></td> <td>status of condition, one of <code>True</code>, <code>False</code>, or <code>Unknown</code>.</td> <td>Yes</td> </tr> <tr> <td>lastTransitionTime</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The last time any field in the condition was changed.</td> <td>No</td> </tr> <tr> <td>reason</td> <td>string</td> <td>A reason for the change in value.</td> <td>No</td> </tr> <tr> <td>message</td> <td>string</td> <td>Human readable decription.</td> <td>No</td> </tr> </tbody> </table> <h3 id=analysis>Analysis<a class=headerlink href=#analysis title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>aggregatedMetrics</td> <td><a href=#aggregatedmetricsanalysis>AggregatedMetricsAnalysis</a></td> <td>Most recently observed metric values for all metrics referenced in the experiment criteria.</td> <td>No</td> </tr> <tr> <td>winnerAssessment</td> <td><a href=#winnerassessmentanalysis>WinnerAssessmentAnalysis</a></td> <td>Information about the <code>winner</code> of the experiment.</td> <td>No</td> </tr> <tr> <td>versionAssessments</td> <td><a href=#versionassessmentanalysis>VersionAssessmentAnalysis</a></td> <td>For each version, a summary analysis identifying whether or not the version is satisfying the experiment criteria.</td> <td>No</td> </tr> <tr> <td>weights</td> <td><a href=#weightanalysis>WeightsAnalysis</a></td> <td>Recommended weight distribution to be applied before the next iteration of the experiment.</td> <td>No</td> </tr> </tbody> </table> <h3 id=versionassessmentanalysis>VersionAssessmentAnalysis<a class=headerlink href=#versionassessmentanalysis title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>provenance</td> <td>string</td> <td>Source of the data. Currently, Iter8 analytics service URL is the only value for this field.</td> <td>Yes</td> </tr> <tr> <td>timestamp</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The time when the analysis took place.</td> <td>Yes</td> </tr> <tr> <td>message</td> <td>string</td> <td>Human readable message.</td> <td>No</td> </tr> <tr> <td>data</td> <td>map[string][]bool</td> <td>map of version name to a list of boolean values, one for each objective specified in the experiment criteria, indicating whether not the objective is satisified.</td> <td>No</td> </tr> </tbody> </table> <h3 id=aggregatedmetricsanalysis>AggregatedMetricsAnalysis<a class=headerlink href=#aggregatedmetricsanalysis title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>provenance</td> <td>string</td> <td>Source of the data. Currently, Iter8 analytics service URL is the only value for this field.</td> <td>Yes</td> </tr> <tr> <td>timestamp</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The time when the analysis took place.</td> <td>Yes</td> </tr> <tr> <td>message</td> <td>string</td> <td>Human readable message.</td> <td>No</td> </tr> <tr> <td>data</td> <td>map[string]<a href=#aggregatedmetricsdata>AggregatedMetricsData</a></td> <td>Map from metric name to most recent data (from all versions) for the metric.</td> <td>Yes</td> </tr> </tbody> </table> <h3 id=aggregatedmetricsdata>AggregatedMetricsData<a class=headerlink href=#aggregatedmetricsdata title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>max</td> <td><a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/ >Quantity</a></td> <td>The maximum value observed for this metric accross all versions.</td> <td>Yes</td> </tr> <tr> <td>min</td> <td><a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/ >Quantity</a></td> <td>The minimum value observed for this metric accross all versions.</td> <td>Yes</td> </tr> <tr> <td>data</td> <td>map[string]<a href=#aggregatedmetricsversiondata>AggregatedMetricsVersionData</a></td> <td>A map from version name to the most recent aggregated metrics data for that version.</td> <td>No</td> </tr> </tbody> </table> <h3 id=aggregatedmetricsversiondata>AggregatedMetricsVersionData<a class=headerlink href=#aggregatedmetricsversiondata title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>max</td> <td><a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/ >Quantity</a></td> <td>The maximum value observed for this metric for this version over all observations.</td> <td>No</td> </tr> <tr> <td>min</td> <td><a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/ >Quantity</a></td> <td>The minimum value observed for this metric for this version over all observations.</td> <td>No</td> </tr> <tr> <td>value</td> <td><a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/ >Quantity</a></td> <td>The value.</td> <td>No</td> </tr> <tr> <td>sampleSize</td> <td>int32</td> <td>The number of requests observed by this version.</td> <td>No</td> </tr> </tbody> </table> <h3 id=winnerassessmentanalysis>WinnerAssessmentAnalysis<a class=headerlink href=#winnerassessmentanalysis title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>provenance</td> <td>string</td> <td>Source of the data. Currently, Iter8 analytics service URL is the only value for this field.</td> <td>Yes</td> </tr> <tr> <td>timestamp</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The time when the analysis took place.</td> <td>Yes</td> </tr> <tr> <td>message</td> <td>string</td> <td>Human readable message.</td> <td>No</td> </tr> <tr> <td>data</td> <td><a href=#winnerassessmentdata>WinnerAssessmentData</a></td> <td>Details on whether or not a winner has been identified and which version if so.</td> <td>No</td> </tr> </tbody> </table> <h3 id=winnerassessmentdata>WinnerAssessmentData<a class=headerlink href=#winnerassessmentdata title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>winnerFound</td> <td>bool</td> <td>Whether or not a winner has been identified.</td> <td>Yes</td> </tr> <tr> <td>winner</td> <td>string</td> <td>The name of the identified winner, if one has been found.</td> <td>No</td> </tr> </tbody> </table> <h3 id=weightanalysis>WeightAnalysis<a class=headerlink href=#weightanalysis title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>provenance</td> <td>string</td> <td>Source of the data. Currently, Iter8 analytics service URL is the only value for this field.</td> <td>Yes</td> </tr> <tr> <td>timestamp</td> <td><a href=https://pkg.go.dev/k8s.io/apimachinery@v0.20.2/pkg/apis/meta/v1#Time>metav1.Time</a></td> <td>The time when the analysis took place.</td> <td>Yes</td> </tr> <tr> <td>message</td> <td>string</td> <td>Human readable message.</td> <td>No</td> </tr> <tr> <td>data</td> <td>[]<a href=#weightdata>WeightData</a></td> <td>List of version name/value pairs representing a recommended weight for each version</td> <td>No</td> </tr> </tbody> </table> <h3 id=weightdata>WeightData<a class=headerlink href=#weightdata title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>name</td> <td>string</td> <td>Version name</td> <td>Yes</td> </tr> <tr> <td>value</td> <td>int32</td> <td>Percentage of traffic being sent to the version.</td> <td>Yes</td> </tr> </tbody> </table> <h2 id=common-field-types>Common field types<a class=headerlink href=#common-field-types title="Permanent link">&para;</a></h2> <h3 id=namedvalue>NamedValue<a class=headerlink href=#namedvalue title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field name</th> <th>Field type</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>name</td> <td>string</td> <td>Name of a variable.</td> <td>Yes</td> </tr> <tr> <td>value</td> <td>string</td> <td>Value of a variable.</td> <td>Yes</td> </tr> </tbody> </table> <h2 id=tasks>Tasks<a class=headerlink href=#tasks title="Permanent link">&para;</a></h2> <p>Tasks are an extension mechanism for enhancing the behavior of Iter8 experiments and can be specified within the <a href=#strategy>spec.strategy.actions</a> field of the experiment.</p> <h3 id=task-implementations>Task implementations<a class=headerlink href=#task-implementations title="Permanent link">&para;</a></h3> <p>Iter8 currently implements two tasks that help in setting up and finishing up experiments. These tasks are organized into the <code>knative</code> and <code>common</code> task libraries.</p> <details class=example><summary>Sample experiment with start and finish actions with tasks</summary><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8.tools/v2alpha2</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Experiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">quickstart-exp</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=c1># `sample-app` Knative service in `default` namespace is the target of this experiment</span>
  <span class=nt>target</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default/sample-app</span>
  <span class=c1># information about app versions participating in this experiment</span>
  <span class=nt>versionInfo</span><span class=p>:</span>         
    <span class=c1># every experiment has a baseline version</span>
    <span class=c1># we will name it `current`</span>
    <span class=nt>baseline</span><span class=p>:</span> 
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">current</span>
      <span class=nt>variables</span><span class=p>:</span>
      <span class=c1># `revision` variable is used for fetching metrics from Prometheus</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span> 
        <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v1</span> 
      <span class=c1># `promote` variable is used by the finish task</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
        <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">base</span>
    <span class=c1># candidate version(s) of the app</span>
    <span class=c1># there is a single candidate in this experiment </span>
    <span class=c1># we will name it `candidate`</span>
    <span class=nt>candidates</span><span class=p>:</span> 
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candidate</span>
      <span class=nt>variables</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span>
        <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v2</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
        <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candid</span>
  <span class=nt>criteria</span><span class=p>:</span>
    <span class=nt>objectives</span><span class=p>:</span> 
    <span class=c1># mean latency should be under 50 milliseconds</span>
    <span class="p p-Indicator">-</span> <span class=nt>metric</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8-knative/mean-latency</span>
      <span class=nt>upperLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
    <span class=c1># 95th percentile latency should be under 100 milliseconds</span>
    <span class="p p-Indicator">-</span> <span class=nt>metric</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8-knative/95th-percentile-tail-latency</span>
      <span class=nt>upperLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class=c1># error rate should be under 1%</span>
    <span class="p p-Indicator">-</span> <span class=nt>metric</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">iter8-knative/error-rate</span>
      <span class=nt>upperLimit</span><span class=p>:</span> <span class=s>&quot;0.01&quot;</span>
    <span class=nt>indicators</span><span class=p>:</span>
    <span class=c1># report values for the following metrics in addition those in spec.criteria.objectives</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">99th-percentile-tail-latency</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">90th-percentile-tail-latency</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">75th-percentile-tail-latency</span>
  <span class=nt>strategy</span><span class=p>:</span>
    <span class=c1># canary testing =&gt; candidate `wins` if it satisfies objectives</span>
    <span class=nt>testingPattern</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Canary</span>
    <span class=c1># progressively shift traffic to candidate, assuming it satisfies objectives</span>
    <span class=nt>deploymentPattern</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Progressive</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class=c1># run tasks under the `start` action at the start of an experiment   </span>
      <span class=nt>start</span><span class=p>:</span>
      <span class=c1># the following task verifies that the `sample-app` Knative service in the `default` namespace is available and ready</span>
      <span class=c1># it then updates the experiment resource with information needed to shift traffic between app versions</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">knative/init-experiment</span>
      <span class=c1># run tasks under the `finish` action at the end of an experiment   </span>
      <span class=nt>finish</span><span class=p>:</span>
      <span class=c1># promote an app version</span>
      <span class=c1># `https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/candidate.yaml` will be applied if candidate satisfies objectives</span>
      <span class=c1># `https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/baseline.yaml` will be applied if candidate fails to satisfy objectives</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span> <span class=c1># promote the winning version</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">kubectl</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;apply&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;-f&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/{{</span><span class=nv> </span><span class=s>.promote</span><span class=nv> </span><span class=s>}}.yaml&quot;</span>
  <span class=nt>duration</span><span class=p>:</span> <span class=c1># 12 iterations, 20 seconds each</span>
    <span class=nt>intervalSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
    <span class=nt>iterationsPerLoop</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
</code></pre></div> </td></tr></table> </details> <h4 id=knativeinit-experiment><code>knative/init-experiment</code><a class=headerlink href=#knativeinit-experiment title="Permanent link">&para;</a></h4> <p>The <code>knative</code> task library provides the <code>init-experiment</code> task. Use this task as part of the <code>start</code> action when experimenting with a Knative service. This task will do the following.</p> <ol> <li> <p>Verify that the target Knative service resource specified in the experiment is available. The target string in the experiment must be formatted as <code>namespace/name</code> of the Knative service.<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup></p> </li> <li> <p>Verify that the target Knative service resource meets three conditions: <code>Ready</code>, <code>ConfigurationsReady</code> and <code>RoutesReady</code>.<sup id=fnref:3><a class=footnote-ref href=#fn:3>3</a></sup></p> </li> <li> <p>Verify that <code>revision</code> information supplied for app versions in the experiment can be found in the Knative service. For example, the sample experiment above refers to two revisions, namely, <code>sample-app-v1</code> and <code>sample-app-v2</code>. The <code>init-experiment</code> task will inspect the <code>status.traffic</code> field of the target Knative service to verify that the revisions are found.</p> </li> <li> <p>Add the <code>namespace</code> variable to the <code>spec.versionInfo</code> field in the experiment. The value of this variable is the namespace of the target Knative service.</p> </li> <li> <p>Add <code>weightObjRef</code> clause within the <code>spec.versionInfo</code> field in the experiment.</p> </li> </ol> <details class=info><summary><code>spec.versionInfo</code> before and after <code>init-experiment</code> is executed</summary><div class=tabbed-set data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Before</label><div class=tabbed-content> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>versionInfo</span><span class=p>:</span>         
  <span class=nt>baseline</span><span class=p>:</span> 
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">current</span>
    <span class=nt>variables</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span> 
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v1</span> 
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">baseline</span>
  <span class=nt>candidates</span><span class=p>:</span> 
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candidate</span>
    <span class=nt>variables</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v2</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candidate</span> 
</code></pre></div> </td></tr></table> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>After</label><div class=tabbed-content> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>versionInfo</span><span class=p>:</span>         
  <span class=nt>baseline</span><span class=p>:</span> 
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">current</span>
    <span class=nt>variables</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span> 
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v1</span> 
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">base</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">namespace</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class=nt>weightObjRef</span><span class=p>:</span>
      <span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">serving.knative.dev/v1</span>
      <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app</span>
      <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
      <span class=nt>fieldPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">.spec.traffic[0].percent</span>  
  <span class=nt>candidates</span><span class=p>:</span> 
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candidate</span>
    <span class=nt>variables</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app-v2</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">candid</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">namespace</span>
      <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class=nt>weightObjRef</span><span class=p>:</span>
      <span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">serving.knative.dev/v1</span>
      <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sample-app</span>
      <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
      <span class=nt>fieldPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">.spec.traffic[1].percent</span>  
</code></pre></div> </td></tr></table> </div> </div> </details> <h4 id=commonexec><code>common/exec</code><a class=headerlink href=#commonexec title="Permanent link">&para;</a></h4> <p>The <code>common</code> task library provides the <code>exec</code> task. Use this task to execute shell commands, in particular, the <code>kubectl</code>, <code>helm</code> and <code>kustomize</code> commands. Use the <code>exec</code> task as part of the <code>finish</code> action to promote the winning version at the end of an experiment. Use it as part of the <code>start</code> action to set up resources required for the experiment.</p> <div class=tabbed-set data-tabs=2:3><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><label for=__tabbed_2_1>kubectl</label><div class=tabbed-content> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span>
  <span class=nt>strategy</span><span class=p>:</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class=nt>start</span><span class=p>:</span>
      <span class=c1># when using common/exec in a start action, always set disableInterpolation to true</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span> <span class=c1># create a K8s resource</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;-c&quot;</span>
          <span class="p p-Indicator">-</span> <span class="p p-Indicator">|</span>
            <span class=no>kubectl apply -f https://raw.githubusercontent.com/my/favourite/resource.yaml</span>
          <span class=nt>disableInterpolation</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>              
      <span class=nt>finish</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span> <span class=c1># promote the winning version</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">kubectl</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;apply&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;-f&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/{{</span><span class=nv> </span><span class=s>.promote</span><span class=nv> </span><span class=s>}}.yaml&quot;</span>
</code></pre></div> </td></tr></table> </div> <input id=__tabbed_2_2 name=__tabbed_2 type=radio><label for=__tabbed_2_2>Helm</label><div class=tabbed-content> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span>
  <span class=nt>strategy</span><span class=p>:</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class=nt>start</span><span class=p>:</span>
      <span class=c1># when using common/exec in a start action, always set disableInterpolation to true</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span> <span class=c1># install a helm chart</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;-c&quot;</span>
          <span class="p p-Indicator">-</span> <span class="p p-Indicator">|</span>
            <span class=no>helm upgrade --install --repo https://raw.githubusercontent.com/my/favorite/helm-repo app --namespace=iter8-system app</span>
          <span class=nt>disableInterpolation</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class=nt>finish</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">helm</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;upgrade&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;--install&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;--repo&quot;</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/canaryprogressive/helm-repo&quot;</span> <span class=c1># repo url</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;sample-app&quot;</span> <span class=c1># release name</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;--namespace=iter8-system&quot;</span> <span class=c1># release namespace</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;sample-app&quot;</span> <span class=c1># chart name</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;--values=https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/canaryprogressive/{{</span><span class=nv> </span><span class=s>.promote</span><span class=nv> </span><span class=s>}}-values.yaml&quot;</span> <span class=c1># placeholder is substituted dynamically</span>
</code></pre></div> </td></tr></table> </div> <input id=__tabbed_2_3 name=__tabbed_2 type=radio><label for=__tabbed_2_3>Kustomize</label><div class=tabbed-content> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span>
  <span class=nt>strategy</span><span class=p>:</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class=nt>start</span><span class=p>:</span>
      <span class=c1># when using common/exec in a start action, always set disableInterpolation to true</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span> <span class=c1># create kubernetes resources</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;-c&quot;</span>
          <span class="p p-Indicator">-</span> <span class="p p-Indicator">|</span>
            <span class=no>kustomize build github.com/my/favorite/kustomize/folder?ref=master | kubectl apply -f -</span>
          <span class=nt>disableInterpolation</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>        
      <span class=nt>finish</span><span class=p>:</span> <span class=c1># run the following sequence of tasks at the end of the experiment</span>
      <span class="p p-Indicator">-</span> <span class=nt>task</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">common/exec</span> <span class=c1># promote the winning version using kustomize</span>
        <span class=nt>with</span><span class=p>:</span>
          <span class=nt>cmd</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
          <span class=nt>args</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;-c&quot;</span>
          <span class="p p-Indicator">-</span> <span class="p p-Indicator">|</span>
          <span class="l l-Scalar l-Scalar-Plain">kustomize build github.com/iter8-tools/iter8/samples/knative/canaryfixedsplit/{{ .name }}?ref=master | kubectl apply -f -</span>
</code></pre></div> </td></tr></table> </div> </div> <h3 id=placeholder-substitution-in-task-inputs>Placeholder substitution in task inputs<a class=headerlink href=#placeholder-substitution-in-task-inputs title="Permanent link">&para;</a></h3> <p>Inputs to tasks can contain placeholders, or template variables, which will be dynamically substituted when the task is executed by Iter8. For example, in the sample experiment above, one input is:</p> <div class=highlight><pre><span></span><code><span class=s2>&quot;https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/{{ .promote }}.yaml&quot;</span>
</code></pre></div> <p>In this case, the placeholder is <code>{{ .promote }}</code>. Placeholder substitution in task inputs works as follows.</p> <ol> <li> <p>Iter8 will find the version recommended for promotion. This information is stored in the <code>status.versionRecommendedForPromotion</code> field of the experiment. The version recommended for promotion is the <code>winner</code>, if a <code>winner</code> has been found in the experiment. Otherwise, it is the baseline version supplied in the <code>spec.versionInfo</code> field of the experiment.</p> </li> <li> <p>If the placeholder is <code>{{ .name }}</code>, Iter8 will substitute it with the name of the version recommended for promotion. Else, if it is any other variable, Iter8 will substitute it with the value of the corresponding variable for the version recommended for promotion. Variable values are specified in the <code>variables</code> field of the version detail. Note that variable values could have been supplied by the creator of the experiment, or by other tasks such as <code>init-experiment</code> that may already have been executed by Iter8 as part of the experiment.</p> </li> </ol> <details class=example><summary>Placeholder substitution Example 1</summary><p>Consider the sample experiment above. Suppose the <code>winner</code> of this experiment was <code>candidate</code>. Then:</p> <ol> <li>The version recommended for promotion is <code>candidate</code>.</li> <li>The placeholder in the argument to the <code>exec</code> task of the <code>finish</code> action is <code>{{ .promote }}</code>.</li> <li>The value of the placeholder for the version recommended for promotion is <code>candid</code>.</li> <li>The command executed by the <code>exec</code> task is then <code>kubectl apply -f https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/candid.yaml</code>.</li> </ol> </details> <details class=example><summary>Placeholder substitution Example 2</summary><p>Consider the sample experiment above. Suppose the <code>winner</code> of this experiment was <code>current</code>. Then:</p> <ol> <li>The version recommended for promotion is <code>current</code>.</li> <li>The placeholder in the argument of the <code>exec</code> task of the <code>finish</code> action is <code>{{ .promote }}</code>.</li> <li>The value of the placeholder for the version recommended for promotion is <code>base</code>.</li> <li>The command executed by the <code>exec</code> task is then <code>kubectl apply -f https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/base.yaml</code>.</li> </ol> </details> <details class=example><summary>Placeholder substitution Example 3</summary><p>Consider the sample experiment above. Suppose the experiment did not yield a <code>winner</code>. Then:</p> <ol> <li>The version recommended for promotion is <code>current</code>.</li> <li>The placeholder in the argument of the <code>exec</code> task of the <code>finish</code> action is <code>{{ .promote }}</code>.</li> <li>The value of the placeholder for the version recommended for promotion is <code>base</code>.</li> <li>The command executed by the <code>exec</code> task is then <code>kubectl apply -f https://raw.githubusercontent.com/iter8-tools/iter8/master/samples/knative/quickstart/base.yaml</code>.</li> </ol> </details> <h3 id=disable-interpolation-always-do-this-in-a-start-action>Disable Interpolation (always do this in a <code>start</code> action)<a class=headerlink href=#disable-interpolation-always-do-this-in-a-start-action title="Permanent link">&para;</a></h3> <p>By default, the <code>common/exec</code> task will attempt to find the version recommended for promotion, and use its values to substitute placeholders in the inputs to the task. However, this behavior will lead to task failure since version recommended for promotion will be generally undefined at this stage of the experiment. To use the <code>common/exec</code> task as part of an experiment <code>start</code> action, set <code>disableInterpolation</code> to <code>true</code> as illustrated in the <code>kubectl/Helm/Kustomize</code> samples above.</p> <h3 id=error-handling-in-tasks>Error handling in tasks<a class=headerlink href=#error-handling-in-tasks title="Permanent link">&para;</a></h3> <p>When a task exits with an error, it will result in the failure of the experiment to which it belongs.</p> <h2 id=target-naming-conventions>Target naming conventions<a class=headerlink href=#target-naming-conventions title="Permanent link">&para;</a></h2> <div class=tabbed-set data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><label for=__tabbed_3_1>Knative</label><div class=tabbed-content> <p>When experimenting with a single Knative service, the convention is to use the fully qualified name (namespace/name) of the Knative service as the target string. In the sample experiment above, the app under experimentation is the Knative service named <code>sample-app</code> under the <code>default</code> namespace. Hence, the target string is <code>default/sample-app</code>.</p> </div> </div> <div class=footnote> <hr> <ol> <li id=fn:1> <p><code>A/B/n</code> experiments involve more than one candidate. Their description is coming soon.&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p>The <code>init-experiment</code> task will repeatedly attempt to find the target Knative service resource in the cluster over a period of 180 seconds. If it cannot find the service at the end of this period, it will exit with an error.&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:3> <p>The <code>init-experiment</code> task will repeatedly attempt to verify that the conditions are met over a period of 180 seconds. If it finds that the conditions are not met at the end of this period, it will exit with an error.&#160;<a class=footnote-backref href=#fnref:3 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> </ol> </div> </article> </div> </div> </main> <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <nav class="md-footer__inner md-grid" aria-label=Footer> <!-- Link to previous page --> <a href=../../metrics/defining-iter8-metrics/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Defining Iter8 metrics </div> </div> </a> <!-- Link to next page --> <a href=../../contributing/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Contributing </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-footer-copyright> Powered by <a href=https://research.ibm.com/ target=_blank rel=noopener> IBM Research </a> </div> <!-- Social links --> <div class=md-footer-social> <a href=https://github.com/iter8-tools/iter8 target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://join.slack.com/t/iter8-tools/shared_invite/zt-awl2se8i-L0pZCpuHntpPejxzLicbmw target=_blank rel=noopener title=join.slack.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> <a href=https://hub.docker.com/r/iter8 target=_blank rel=noopener title=hub.docker.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.sections", "navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fe42c31b.min.js", "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.4ea5477f.min.js></script> </body> </html>